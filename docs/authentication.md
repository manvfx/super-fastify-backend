# Authentication

List of Entities that can access the API & system resources.
| Entity | Description |
| --- | --- |
| User | any ordinary user of the system. free or paid. |
| Operator | any user that can access the system resources for management purpose like admin or support. |
| System Worker | Program, scripts that do some automated or scheduled tasks |
| Bots | Automated programs that generate trading signals. Maybe provided by 3rd parties |

## Authentication Flow
All none public resources are protected by authentication mechanism. The authentication mechanism is based on Paseto Tokens.
All requests to the API must include a valid Paseto token in the `Authorization` header.
The token that is stored in Authorization header validated by a request hook in fastify and all payload will be injected to the request object.
There is a ts (TimeStamp) field in the token payload that is used to validate the token expiration time. if the token is expired, no payload will be injected to the request object but the request will be processed normally.
It is the responsibility of each endpoints to check if the request object has populated with the authorized role payload or not.

## Token Generation
For each entity tokens generated with a specific procedure. The procedure is described in the following sections.
| Entity | Token Generation Procedure | Expiration Time |
| --- | --- | --- |
| User | Tokens generated after successful registration or login. | Tokens are valid infinitely unless `token.ts < user.authResetTs` |
| Operator | Tokens generated after successful login. | Tokens are valid infinitely unless `token.ts < operator.authResetTs` |
| System Worker | Tokens generated by the system trough adminstration panel | Tokens are valid infinitely |
| Bots | Tokens generated by the system trough Bot registration API | Tokens are valid infinitely |

## Tokens Payload
Each entity has a specific payload in the token. The payload is described in the following sections.
| Entity | Payload | Description |
| --- | --- | --- |
| * | `entity` | The entity that the token belongs to. can be user, operator, worker, bot |
| * | `ts` | TimeStamp of the token generation |
| * | `_id` | The id of the entity that the token belongs to |
| User | `plan` | plan that user subscribed to. default is `regular` |
| Operator | `role` | role of the operator. can be `admin` or `support` or ... |

